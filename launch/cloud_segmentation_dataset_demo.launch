<?xml version="1.0" encoding="UTF-8" ?>

<launch>
    <arg name="device" default="cuda" doc="Device to run tensor operations on: cpu or cuda"/>
    <arg name="data_sequence" default="00000" doc="Sequence name from Rellis-3D dataset"/>
    <arg name="rviz" default="true"/>

    <include file="$(dirname)/robot_data.launch">
        <arg name="data_sequence" value="$(arg data_sequence)"/>
        <arg name="map_step" value="1"/>
        <arg name="pose_step" value="10"/>
    </include>

    <node name="cloud_segmentation_inference" pkg="traversability_estimation" type="cloud_segmentation_inference" output="screen">
        <rosparam subst_value="true">
            device: $(arg device)
            max_age: 1.0
            lidar_channels: 64
            lidar_beams: 2048
            lidar_fov_up: 22.5
            lidar_fov_down: -22.5
            input_filelds: ['x', 'y', 'z', 'i']
            output_fields: ['x', 'y', 'z', 'r', 'g', 'b', 'obstacle']
<!--            weights: 'fcn_resnet101_lr_0.0001_bs_16_epoch_22_Rellis3DClouds_depth_iou_0.67.pth'-->
            weights: deeplabv3_resnet101_lr_0.0001_bs_16_epoch_64_Rellis3DClouds_z_depth_iou_0.68.pth
        </rosparam>
        <rosparam param="label_map" command="load" file="$(dirname)/../config/rellis_to_obstacles.yaml"/>
        <remap from="cloud_in" to="/robot_data/lidar_cloud"/>
        <remap from="cloud_out" to="/cloud_segmentation/lidar_cloud"/>
    </node>

    <!-- RVIZ -->
    <node if="$(arg rviz)" name="rviz" pkg="rviz" type="rviz"
          args="-d $(find traversability_estimation)/config/rviz/cloud_segm.rviz"/>

</launch>
