<?xml version="1.0" encoding="UTF-8" ?>
<launch>
<!--    <arg name="bag" default="$(dirname)/../data/bags/traversability/tradr/ugv_2022-06-30-14-23-28.bag $(dirname)/../data/bags/traversability/tradr/ugv_2022-06-30-14-23-28_cameras.bag"/>-->
<!--    <arg name="bag" default="$(dirname)/../data/bags/traversability/husky_2022-06-30-15-11-49.bag $(dirname)/../data/bags/traversability/husky_2022-06-30-15-11-49.no_sensors.bag"/>-->
    <!--    <arg name="bag" default="/media/petrito1/tp-t5/data/robingas/22-08-12_cimicky_haj/marv/ugv_2022-08-12-15-18-34.bag"/>-->
<!--    <arg name="bag" default="/media/petrito1/tp-t5/data/robingas/22-08-12_cimicky_haj/marv/ugv_2022-08-12-16-08-17.bag"/>-->
<!--        <arg name="bag" default="$(dirname)/../data/bags/traversability/marv/ugv_2022-08-12-15-18-34.bag"/>-->
    <arg name="bag" default="$(dirname)/../data/bags/traversability/marv/ugv_2022-08-12-16-08-17.bag"/>

    <arg name="robot" default="$(eval 'marv' if 'marv' in bag else 'tradr')"/>
    <arg name="params" default="$(eval bag.split()[0] + '.params')"/>
    <arg name="device" default="cuda" doc="Device to run tensor operations on: cpu or cuda."/>
    <arg name="rviz" default="true" doc="Launch RViz for data visualization or not."/>

    <param name="use_sim_time" value="true"/>

    <rosparam command="load" file="$(arg params)"/>
    <node name="rosbag_play" pkg="rosbag" type="play" args="--clock --delay 3.0 --rate 1.0 --start 400 $(arg bag)"/>

<!--    <include file="$(dirname)/$(arg robot)_robot.launch" pass_all_args="true"/>-->

    <include file="$(find cras_ouster_driver)/launch/os_cloud_node.launch">
<!--        <arg name="fields_to_publish" value="intensity,reflectivity,ambient,t"/>-->
    </include>
<!--    <node name="destagger" pkg="nodelet" type="nodelet" args="standalone cras_ouster_driver/destagger_nodelet">-->
<!--        <remap from="info" to="/os_node/sensor_info"/>-->
<!--        <remap from="input" to="/os_cloud_node/points"/>-->
<!--        <remap from="output" to="/os_cloud_node/destaggered_points"/>-->
<!--    </node>-->
    <node name="cloud_to_depth_points" pkg="traversability_estimation" type="cloud_to_depth">
        <remap from="cloud" to="/os_cloud_node/points"/>
        <remap from="image" to="/os_cloud_node/points_depth"/>
    </node>
    <node name="cloud_to_depth_destaggered" pkg="traversability_estimation" type="cloud_to_depth">
        <remap from="cloud" to="/os_cloud_node/destaggered_points"/>
        <remap from="image" to="/os_cloud_node/destaggered_points_depth"/>
    </node>
    <include file="$(dirname)/slam.launch">
        <arg name="cloud" value="/os_cloud_node/points"/>
    </include>

    <include file="$(dirname)/ctu_robot_cloud.launch" pass_all_args="true"/>

    <node if="$(arg rviz)" name="rviz" pkg="rviz" type="rviz"
          args="-d $(find traversability_estimation)/config/rviz/$(arg robot).rviz"/>
</launch>
